{% extends "network/layout.html" %}
{% load static %}

{% block body %}


  
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
           {%for following in followings%}          
          <h3><a href="/profile/{{following.following}}" style="text-transform: capitalize;">{{following.following}}</a></h3>
          {%endfor%}

          
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>



 <!-- Modal2 -->
 <div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
           {%for follower in followers%}          
          <h3><a href="/profile/{{follower.followers}}" style="text-transform: capitalize;">{{follower.followers}}</a></h3>
          {%endfor%}

          
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>







<div class="padding" id="padding">
    <div class="col-md-8">
        <!-- Column -->
            <div class="card-body little-profile text-center">
                <h3 class="capitalize" class="m-b-0"  id="username">{{username}}</h3>
                <!-- make sure to not show follow button on the own user profile -->
            {%if user_name != username %}
            {%if followers%}
               {%for follower in followers%}
               <!-- if the user already following the pofile ,display the unfollow button -->
                   {%if follower.followers == user_name%}
                        
                   <p>Web Designer &amp; Developer</p> <a class="m-t-10 waves-effect waves-dark btn btn-primary btn-md btn-rounded" data-abc="true" id="unfollow_button">Unfollow</a>
                    {%else %}
                   
                   
                   <p>Web Designer &amp; Developer</p> <a class="m-t-10 waves-effect waves-dark btn btn-primary btn-md btn-rounded" data-abc="true" id="follow_button">Follow</a>
                    {%endif%}
                {%endfor%}
                <!-- if there were no followers then show the follow button  -->
                {%else%}
                <p>Web Designer &amp; Developer</p> <a class="m-t-10 waves-effect waves-dark btn btn-primary btn-md btn-rounded" data-abc="true" id="follow_button">Follow</a>
                {%endif%}
                {%endif%}
                <br>
                <hr>
                <div class="row text-center m-t-20">
                    <div class="col-lg-4 col-md-4 m-t-20">
                        <h3 class="m-b-0 font-light">{{post_count}}</h3><small><button type="button" class="btn btn-outline-primary" disabled>Posts</button></small>
                    </div>
                    <div class="col-lg-4 col-md-4 m-t-20">
                        <h3 class="m-b-0 font-light">{{followers_count}}</h3><small><button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#exampleModal2">Followers</button></small>
                    </div>
                    <div class="col-lg-4 col-md-4 m-t-20">
                        <h3 class="m-b-0 font-light">{{following_count}}</h3><small><button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">Following</button></small>

                    </div>

                </div>

            </div>
        </div>
        
        <br>
    </div>





<script>

window.onpopstate = function(event) {
console.log(event.state)
}


    document.addEventListener('DOMContentLoaded', function() {
    
    let user = document.querySelector("#username")
    load_user_posts(user.innerHTML)
},{ once: true });
  




 
 function load_user_posts(user){

        fetch(`/posts/${user}`)
       .then(response => response.json())
         .then(posts => {
            posts.forEach(function(post){
                let div = document.createElement("div");
                div.setAttribute("id","posts")
                div.innerHTML = ` <a href='/profile/${post.author}'   id='profile-page' data-profile=${post.author_id} data-name=${post.author} ><P>${post.timestamp}</p><h1 class='capitalize'>${post.author}</h1></a>  <h3>${post.post}</h3>  <p>${post.likes}</p> <button>Likes</button> `
                document.querySelector("#padding").append(div)
               console.log(post)

            })
           
         })
 
     }
     
     try {
     document.querySelector("#follow_button").addEventListener('click', function() {
    console.log(document.querySelector("#username").innerHTML)
     fetch(`/following`,{
            method: 'POST',
             body: JSON.stringify({
             following_new_user: document.querySelector("#username").innerHTML                  
              })
         
              })
         .then(response => response.json())
           .then(result => {
            location.reload()
            console.log(result)
           })
 },{ once: true });

} catch {
  document.querySelector("#unfollow_button").addEventListener('click', function() {
    fetch(`/unfollow`,{
            method: 'POST',
             body: JSON.stringify({
             unfollow: document.querySelector("#username").innerHTML                  
              })
         
              })
         .then(response => response.json())
           .then(result => {
            location.reload()
            console.log(result)
           })

  });

}

</script>

{% endblock %}
